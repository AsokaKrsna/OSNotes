OSNotes - Final Design Document
Mission: Free, open-source note-taking app for students. No paywalls. No lock-in.

Core Architecture
File System
User Selected Folder/
├── Physics/
│   ├── Chapter 1.pdf
│   └── Lab Notes.pdf
└── Math/
    └── Calculus.pdf
Save Flow
PDF → Cached Copy → Annotations in DB → "Make Permanent" → PDF
Annotations linked to Page UUIDs (not indices)
Auto-save to DB every 10 seconds
Red save icon when unsaved
"Make Permanent" flattens to PDF
Screens
1. Home Screen
Favorites bar (horizontal scroll)
Recent notes (horizontal scroll)
Collections (folder list)
FAB: New Note / New Folder
2. Folder View
Grid of note thumbnails with star indicator
Create note/folder
Long press for options
3. Note Editor
Super minimal - clean canvas
Nothing at bottom (accidental touch prevention)
Glassmorphic toolbar on edge (configurable)
Waterdrop page indicator (expands on tap)
Stylus = write, Finger = navigate
4. Page Manager
Thumbnail grid (drag to reorder)
Tap page → opens that page
Long press → duplicate/delete/change template
Add page with template + location picker
Toolbar (Glassmorphic)
Position: Right | Left | Top (user setting)
Tools
Tool	Action
Pen	Pressure-sensitive ink
Highlighter	Semi-transparent
Eraser	Removes strokes AND shapes
Lasso	Select, move, resize, copy
Textbox	Insert typed text
Shapes	Rect, circle, line, arrow
Ruler	Straight edge + angle guide
Undo/Redo	Action history
Add Page	Quick add with template picker
Page Manager	Full page grid
Interaction
Tap: Select tool
Tap again: Show presets
Long press: Customization panel
Page Management
Insert Page Dialog
┌─────────────────────────────────┐
│  Add Page                       │
├─────────────────────────────────┤
│  Template: [Blank ▼]            │
│                                 │
│  Insert at:                     │
│  ○ Start of document            │
│  ● After current page           │
│  ○ End of document              │
│                                 │
│  [Cancel]        [Add Page]     │
└─────────────────────────────────┘
Templates
Blank | Grid | Dot Grid | Cornell Notes | Meeting Minutes | Two Column
Custom templates (user-created)
Custom Template Creator
┌─────────────────────────────────┐
│  Create Template                │
├─────────────────────────────────┤
│  ┌───────────────────────────┐  │
│  │                           │  │
│  │    [LIVE PREVIEW]         │  │
│  │                           │  │
│  └───────────────────────────┘  │
│                                 │
│  Background: [Color]            │
│                                 │
│  + Horizontal Lines             │
│  + Vertical Lines               │
│  + Grid Pattern                 │
│  + Dot Pattern                  │
│  + Text Label                   │
│  + Box/Section                  │
│                                 │
│  [Save Template]                │
└─────────────────────────────────┘
Technical: Page ID System
data class Page(
    val id: UUID,           // Stable identifier
    val index: Int,         // Current position (mutable)
    val templateId: String? // Template used
)
data class Annotation(
    val id: UUID,
    val pageId: UUID,       // Links to Page.id, NOT index
    val type: AnnotationType,
    val data: ByteArray
)
Benefits:

Reordering pages doesn't break annotations
Deleting page X doesn't affect page X+1's annotations
Safe page duplication
Implementation Phases
Phase 1: Core
 File browser + folder/file creation
 PDF viewing with MuPDF
 Page navigation with waterdrop
 Basic inking canvas
Phase 2: Toolbar
 Glassmorphic toolbar (3 positions)
 All tools with presets
 Stylus detection + palm rejection
 Eraser (strokes + shapes)
Phase 3: Pages
 Page ID system with DB annotations
 Add/delete/reorder pages
 Template picker + creator
 Make Permanent feature
Phase 4: Polish
 Favorites + recent
 Settings screen
 Glassmorphic theme throughout
 Export/share